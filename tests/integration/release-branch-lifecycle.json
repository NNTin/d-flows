{
  "name": "Release Branch Lifecycle",
  "description": "Tests the automatic release branch creation feature and validates the ability to maintain multiple major versions simultaneously. This validates automatic release branch creation during major bump, branch created from correct commit, patches on release branch only affect that major version, and main branch continues independent development.",
  "steps": [
    {
      "name": "Setup complete release history",
      "action": "setup-git-state",
      "scenario": "FirstRelease",
      "expectedState": {
        "tags": [],
        "branches": ["main"],
        "currentBranch": "main"
      }
    },
    {
      "name": "Creating empty commit before release",
      "action": "execute-command",
      "command": "git commit --allow-empty -m 'Trigger release v0.2.1'"
    },
    {
      "name": "Execute v0.2.1 release workflow",
      "action": "run-workflow",
      "workflow": "release.yml",
      "fixture": "tests/release/valid-release-v0.2.1.json",
      "expectedOutputs": {
        "MAJOR_VERSION": "0"
      }
    },
    {
      "name": "Creating empty commit before release",
      "action": "execute-command",
      "command": "git commit --allow-empty -m 'Trigger release v1.0.0'"
    },
    {
      "name": "Execute major bump-version workflow",
      "action": "run-workflow",
      "workflow": "bump-version.yml",
      "fixture": "tests/bump-version/major-bump-main.json",
      "expectedOutputs": {
        "NEW_VERSION": "1.0.0",
        "FIRST_RELEASE": "false",
        "CURRENT_MAJOR": "0"
      },
      "expectedStepSummary": [
        "ðŸ”¼ major bump: 0.2.1 â†’ 1.0.0",
        "âœ… Version validation passed"
      ]
    },
    {
      "name": "Execute v1.0.0 release workflow",
      "action": "run-workflow",
      "workflow": "release.yml",
      "fixture": "tests/release/valid-release-v1.0.0.json",
      "expectedOutputs": {
        "MAJOR_VERSION": "1"
      }
    },
    {
      "name": "Validate release branch creation",
      "action": "validate-state",
      "checks": [
        {"type": "tag-points-to", "tag": "v1", "target": "v1.0.0"}
      ]
    },
    {
      "name": "Creating empty commit before release",
      "action": "execute-command",
      "command": "git commit --allow-empty -m 'Trigger release v1.1.0'"
    },
    {
      "name": "Execute v1.1.0 release workflow",
      "action": "run-workflow",
      "workflow": "release.yml",
      "fixture": "tests/release/valid-release-v1.1.0.json",
      "expectedOutputs": {
        "MAJOR_VERSION": "1"
      }
    },
    {
      "name": "Creating empty commit before release",
      "action": "execute-command",
      "command": "git commit --allow-empty -m 'Trigger release v2.0.0'"
    },
    {
      "name": "Major bump: v1.1.0 â†’ v2.0.0",
      "action": "run-workflow",
      "workflow": "bump-version.yml",
      "fixture": "tests/bump-version/major-bump-main.json",
      "expectedOutputs": {
        "NEW_VERSION": "2.0.0",
        "CURRENT_MAJOR": "1",
        "RELEASE_BRANCH_CREATED": "true"
      }
    },
    {
      "name": "Validate release branch creation",
      "action": "validate-state",
      "checks": [
        {"type": "branch-exists", "branch": "release/v0"},
        {"type": "branch-exists", "branch": "release/v1"},
        {"type": "tag-points-to", "tag": "v0", "target": "v0.2.1"},
        {"type": "tag-points-to", "tag": "v1", "target": "v1.1.0"}
      ]
    },
    {
      "name": "Execute release workflow for v2.0.0",
      "action": "run-workflow",
      "workflow": "release.yml",
      "fixture": "tests/release/valid-release-v2.0.0.json",
      "expectedOutputs": {
        "MAJOR_VERSION": "2"
      }
    },
    {
      "name": "Validate release branch creation",
      "action": "validate-state",
      "checks": [
        {"type": "tag-exists", "tag": "v2.0.0"},
        {"type": "tag-exists", "tag": "v2"},
        {"type": "tag-points-to", "tag": "v2", "target": "v2.0.0"},
        {"type": "current-branch", "branch": "main"}
      ]
    },
    {
      "name": "In order to create a new branch, we need to be attached to something",
      "action": "execute-command",
      "command": "git checkout main"
    },
    {
      "name": "Checking out release/v1 branch",
      "action": "execute-command",
      "command": "git checkout -b release/v1"
    },
    {
      "name": "Creating empty commit before release",
      "action": "execute-command",
      "command": "git commit --allow-empty -m 'Trigger release v1.2.0'"
    },
    {
      "name": "Patch on release/v1 branch: v1.1.0 â†’ v1.2.0",
      "action": "run-workflow",
      "workflow": "bump-version.yml",
      "fixture": "tests/bump-version/minor-bump-release-branch.json",
      "expectedOutputs": {
        "NEW_VERSION": "1.2.0"
      }
    },
    {
      "name": "Execute release workflow for v1.2.0",
      "action": "run-workflow",
      "workflow": "release.yml",
      "fixture": "tests/release/valid-release-v1.2.0.json",
      "expectedOutputs": {
        "MAJOR_VERSION": "1"
      }
    },
    {
      "name": "Validate release branch creation",
      "action": "validate-state",
      "checks": [
        {"type": "tag-exists", "tag": "v1.2.0"},
        {"type": "tag-exists", "tag": "v1"},
        {"type": "tag-points-to", "tag": "v1", "target": "v1.2.0"},
        {"type": "current-branch", "branch": "release/v1"}
      ]
    },
    {
      "name": "Patch on release/v1 branch: v1.2.0 â†’ v1.2.1",
      "action": "run-workflow",
      "workflow": "bump-version.yml",
      "fixture": "tests/bump-version/patch-bump-release-branch.json",
      "expectedOutputs": {
        "NEW_VERSION": "1.2.1"
      }
    },
    {
      "name": "Execute release workflow for v1.2.1 on release/v1",
      "action": "run-workflow",
      "workflow": "release.yml",
      "fixture": "tests/release/valid-release-v1.2.1-branch.json",
      "expectedOutputs": {
        "MAJOR_VERSION": "1"
      }
    },
    {
      "name": "Validate release branch patch",
      "action": "validate-state",
      "checks": [
        {"type": "tag-exists", "tag": "v1.2.1"},
        {"type": "tag-points-to", "tag": "v1", "target": "v1.2.1"},
        {"type": "current-branch", "branch": "release/v1"}
      ]
    },
    {
      "name": "Checking out main",
      "action": "execute-command",
      "command": "git checkout main"
    },
    {
      "name": "Creating empty commit before release",
      "action": "execute-command",
      "command": "git commit --allow-empty -m 'Trigger release v2.1.0'"
    },
    {
      "name": "Minor on main: v2.0.0 â†’ v2.1.0",
      "action": "run-workflow",
      "workflow": "bump-version.yml",
      "fixture": "tests/bump-version/minor-bump-main.json",
      "expectedOutputs": {
        "NEW_VERSION": "2.1.0"
      }
    },
    {
      "name": "Validate independent major version branches",
      "action": "validate-state",
      "checks": [
        {"type": "tag-exists", "tag": "v2.1.0"},
        {"type": "tag-exists", "tag": "v1.2.1"},
        {"type": "tag-points-to", "tag": "v1", "target": "v1.2.1"},
        {"type": "tag-points-to", "tag": "v2", "target": "v2.1.0"},
        {"type": "no-cross-contamination", "v1": "v1.2.1", "v2": "v2.1.0"}
      ]
    }
  ],
  "cleanup": {
    "action": "reset-git-state"
  },
  "expectedDuration": "45-90 seconds",
  "tags": ["integration", "release-branch", "major-versions", "branch-management"]
}
