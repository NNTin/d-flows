{
  "name": "Duplicate Tag Error Recovery",
  "description": "Tests error recovery from duplicate tag scenario. This validates that workflows detect duplicate tags before making changes, fail gracefully with clear error messages, have no partial state changes, and can safely retry after fixing the issue.",
  "steps": [
    {
      "name": "Setup duplicate tag error scenario",
      "action": "setup-git-state",
      "scenario": "DuplicateTag",
      "expectedState": {
        "tags": ["v0.1.0", "v0.1.1"],
        "branches": ["main"],
        "currentBranch": "main"
      }
    },
    {
      "name": "Attempt patch bump from v0.1.0 (should fail)",
      "action": "run-workflow",
      "workflow": "bump-version.yml",
      "fixture": "tests/bump-version/error-duplicate-tag.json",
      "expectedFailure": true,
      "expectedErrorMessage": "duplicate"
    },
    {
      "name": "Validate graceful failure - no state changes",
      "action": "validate-state",
      "checks": [
        {"type": "tag-count", "expected": 2},
        {"type": "branch-count", "expected": 1},
        {"type": "no-new-tags"}
      ]
    },
    {
      "name": "Recover: Delete conflicting v0.1.1 tag",
      "action": "execute-command",
      "command": "git tag -d v0.1.1"
    },
    {
      "name": "Validate state after recovery",
      "action": "validate-state",
      "checks": [
        {"type": "tag-exists", "tag": "v0.1.0"},
        {"type": "tag-not-exists", "tag": "v0.1.1"}
      ]
    },
    {
      "name": "Retry patch bump after recovery",
      "action": "run-workflow",
      "workflow": "bump-version.yml",
      "fixture": "tests/bump-version/patch-bump-main.json",
      "expectedOutputs": {
        "NEW_VERSION": "0.1.1"
      }
    },
    {
      "name": "Validate success after recovery",
      "action": "validate-state",
      "checks": [
        {"type": "tag-exists", "tag": "v0.1.1"},
        {"type": "tag-exists", "tag": "v0"},
        {"type": "idempotency-verified"}
      ]
    }
  ],
  "cleanup": {
    "action": "reset-git-state"
  },
  "expectedDuration": "30-60 seconds",
  "tags": ["integration", "error-recovery", "duplicate-tag", "resilience"]
}
