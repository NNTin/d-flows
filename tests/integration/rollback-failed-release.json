{
  "name": "Failed Release Workflow Retry",
  "description": "Tests the two-workflow architecture and validates that failures in the release workflow don't corrupt version calculation. This validates that bump-version and release are independent, bump-version can complete even if release fails, releases can be manually triggered independently, and workflows are idempotent.",
  "steps": [
    {
      "name": "Setup initial state with v0.1.0",
      "action": "setup-git-state",
      "scenario": "PatchBump",
      "expectedState": {
        "tags": ["v0.1.0"],
        "branches": ["main"],
        "currentBranch": "main"
      }
    },
    {
      "name": "Execute bump-version workflow",
      "action": "run-workflow",
      "workflow": "bump-version.yml",
      "fixture": "tests/bump-version/patch-bump-main.json",
      "expectedOutputs": {
        "NEW_VERSION": "0.1.1"
      }
    },
    {
      "name": "Validate bump-version completed",
      "action": "validate-state",
      "checks": [
        {"type": "workflow-success", "workflow": "bump-version.yml"}
      ]
    },
    {
      "name": "Simulate release workflow not triggered",
      "action": "comment",
      "text": "Note: Act cannot fully simulate workflow triggers. This validates version calculation completed; release must be manually verified."
    },
    {
      "name": "Verify version calculation is stable",
      "action": "validate-state",
      "checks": [
        {"type": "tag-exists", "tag": "v0.1.1", "expectation": false},
        {"type": "workflow-output-captured", "key": "NEW_VERSION", "value": "0.1.1"}
      ]
    },
    {
      "name": "Manually trigger release workflow with version 0.1.1",
      "action": "run-workflow",
      "workflow": "release.yml",
      "fixture": "tests/release/valid-release-v0.1.1.json",
      "expectedOutputs": {
        "MAJOR_VERSION": "0"
      }
    },
    {
      "name": "Validate release created after manual trigger",
      "action": "validate-state",
      "checks": [
        {"type": "tag-exists", "tag": "v0.1.1"},
        {"type": "tag-exists", "tag": "v0"},
        {"type": "workflow-success", "workflow": "release.yml"}
      ]
    },
    {
      "name": "Validate workflow separation and independence",
      "action": "validate-state",
      "checks": [
        {"type": "state-consistency", "expectation": "both-workflows-independent"},
        {"type": "no-corruption", "state": "version-metadata"}
      ]
    }
  ],
  "cleanup": {
    "action": "reset-git-state"
  },
  "expectedDuration": "30-60 seconds",
  "tags": ["integration", "error-recovery", "workflow-separation", "manual-trigger"]
}
